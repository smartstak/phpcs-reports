!function(t){"use strict";class s{constructor(t){this.$el=t,this.state={postType:t.data("post-type"),taxonomy:t.data("taxonomy"),perPage:t.data("per-page"),filterPosition:t.data("filter-position"),paginationType:t.data("pagination"),page:1,maxPages:1,selectedCats:[],priceMin:"",priceMax:"",sort:"date",loading:!1},this.$grid=t.find(".sflts-grid"),this.$count=t.find(".sflts-count"),this.$loadMore=t.find(".sflts-load-more"),this.$pagination=t.find(".sflts-pagination-links"),this.bind(),this.initSlider(),this.fetch()}bind(){const s=this;this.$el.on("change",".sflts-filter-category",function(){const e=parseInt(t(this).val(),10);t(this).is(":checked")?s.state.selectedCats.push(e):s.state.selectedCats=s.state.selectedCats.filter(t=>t!==e),s.resetAndFetch()}),this.$el.on("change",".sflts-price-min, .sflts-price-max",()=>{const t=s.$el.find(".sflts-price-min"),e=s.$el.find(".sflts-price-max"),a=parseFloat(t.data("default")),i=parseFloat(e.data("default"));let n=""!==t.val()?parseFloat(t.val()):null,l=""!==e.val()?parseFloat(e.val()):null;null===n&&null===l?(n=a,l=i):(null===n&&(n=a),null===l&&(l=i)),s.state.priceMin=n,s.state.priceMax=l,s.slider&&s.slider.set([n,l]),s.resetAndFetch()}),this.$el.on("change",".sflts-sort-select",function(){s.state.sort=t(this).val(),s.resetAndFetch()}),this.$el.on("click",".sflts-reset",()=>{s.$el.find(".sflts-filter-category").prop("checked",!1),s.$el.find(".sflts-price-min, .sflts-price-max").val(""),s.$el.find(".sflts-sort-select").val("date"),s.state.selectedCats=[],s.state.priceMin="",s.state.priceMax="",s.state.sort="date",s.slider&&s.slider.set([0,1e3]),s.resetAndFetch()}),this.$loadMore.on("click",()=>{s.state.page<s.state.maxPages&&(s.state.page+=1,s.fetch(!0))}),this.$pagination.on("click","a",function(e){e.preventDefault();const a=parseInt(t(this).data("page"),10);a&&a!==s.state.page&&(s.state.page=a,s.fetch())})}initSlider(){const t=this.$el.find(".sflts-price-slider")[0];if(t&&window.noUiSlider){const s=parseFloat(t.dataset.min)||0,e=parseFloat(t.dataset.max)||1e3,a=this.state.priceMin||s,i=this.state.priceMax||e;this.slider=noUiSlider.create(t,{start:[a,i],connect:!0,range:{min:s,max:e}}),this.slider.on("change",t=>{this.$el.find(".sflts-price-min").val(t[0]),this.$el.find(".sflts-price-max").val(t[1]),this.state.priceMin=t[0],this.state.priceMax=t[1],this.resetAndFetch()})}}resetAndFetch(){this.state.page=1,this.fetch()}fetch(s=!1){if(this.state.loading)return;this.state.loading=!0;const e={action:"sflts_filter",nonce:sfltsData.nonce,post_type:this.state.postType,taxonomy:this.state.taxonomy,paged:this.state.page,per_page:this.state.perPage,categories:this.state.selectedCats,price_min:this.state.priceMin,price_max:this.state.priceMax,sort:this.state.sort};s||this.$grid.addClass("sflts-loading").html(`<p>${sfltsData.strings.loading}</p>`),t.post(sfltsData.ajaxUrl,e,t=>{if(t.success)s?this.$grid.append(t.data.html):this.$grid.html(t.data.html).removeClass("sflts-loading"),this.state.maxPages=t.data.max_pages,this.updateCounts(t.data.total),this.updatePagination();else{const s=t.data&&t.data.message?t.data.message:sfltsData.strings.noResults;this.$grid.html('<p class="sflts-error"></p>'),this.$grid.find(".sflts-error").text(s)}}).always(()=>{this.state.loading=!1})}updateCounts(t){const s=this.$grid.find(".sflts-item").length;this.$count.text(`${s} / ${t}`)}updatePagination(){if("load_more"===this.state.paginationType)return void(this.state.page<this.state.maxPages?(this.$loadMore.show(),this.$pagination.hide()):this.$loadMore.hide());this.$loadMore.hide();const t=this.state.maxPages,s=this.state.page;if(t<=1)return void this.$pagination.hide();let e="";const a=new Set,i=i=>{i<1||i>t||a.has(i)||(a.add(i),e+=`<a href="#" data-page="${i}"${i===s?' class="active"':""}>${i}</a>`)};i(1),i(2),s>4&&(e+='<span class="sflts-ellipsis">…</span>'),i(s-1),i(s),i(s+1),s<t-3&&(e+='<span class="sflts-ellipsis">…</span>'),i(t-1),i(t),this.$pagination.html(e).show()}}t(document).ready(()=>{t(".sflts-container").each(function(){new s(t(this))})})}(jQuery);